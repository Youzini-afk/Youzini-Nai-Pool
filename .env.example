ENVIRONMENT=dev
NODE_ID=node-1
MULTI_NODE_ENABLED=false
SECRET_KEY=change-me
ENCRYPTION_KEY=your-32-byte-base64-key
DATABASE_URL=sqlite+aiosqlite:///./data/novelai_pool.db
# Multi-node (recommended): use Postgres instead of SQLite
# DATABASE_URL=postgresql+asyncpg://novelai:novelai@127.0.0.1:5432/novelai_pool
SYSTEM_CONFIG_REFRESH_ENABLED=true
SYSTEM_CONFIG_REFRESH_INTERVAL_SECONDS=5
CORS_ALLOW_ORIGINS=
# CORS_ALLOW_ORIGINS=*  # only if you really need cross-origin access
CORS_ALLOW_CREDENTIALS=false
# Trust X-Real-IP / X-Forwarded-For only when behind reverse proxy.
TRUST_PROXY_HEADERS=false
AUTH_LOGIN_RATE_LIMIT_PER_MINUTE=20
AUTH_REGISTER_RATE_LIMIT_PER_MINUTE=10
AUTH_LOGIN_LOCKOUT_THRESHOLD=10
AUTH_LOGIN_LOCKOUT_MINUTES=10
AUTH_PASSWORD_MIN_LENGTH=8

ALLOW_REGISTRATION=true
ADMIN_USERNAME=admin
ADMIN_PASSWORD=change-me
ADMIN_FORCE_RESET=false

AUTO_QUOTA_ENABLED=true
BASE_RPM=0
PER_KEY_RPM=10
MAX_RPM=120
BASE_RPM_CONTRIBUTOR_ONLY=true
MANUAL_GLOBAL_RPM=0

KEY_COOLDOWN_SECONDS=3
DYNAMIC_COOLDOWN_ENABLED=true
COOLDOWN_MAX_SECONDS=300
COOLDOWN_409_BASE_SECONDS=3
COOLDOWN_429_BASE_SECONDS=8
COOLDOWN_5XX_BASE_SECONDS=15
COOLDOWN_402_BASE_SECONDS=60

OPUS_MAX_PIXELS=1048576
OPUS_MAX_STEPS=28
OPUS_MAX_SAMPLES=1
NOVELAI_DEFAULT_MODEL=nai-diffusion-4-5-full
NOVELAI_MODELS=nai-diffusion-3,nai-diffusion-4-full,nai-diffusion-4-curated-preview,nai-diffusion-4-5-curated,nai-diffusion-4-5-full

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL_SECONDS=300
HEALTH_CHECK_FAIL_THRESHOLD=3
# Multi-node: avoid every node running health checks (choose ONE leader node)
HEALTH_CHECK_LEADER_ONLY=false
HEALTH_CHECK_LEADER_NODE_ID=node-1
REQUIRE_OPUS_TIER=true  # Opus tier=3

LOG_RETENTION_DAYS=30
LOG_REQUEST_IP=false

# Upstream proxy pool (availability). Do NOT use for bypassing upstream restrictions.
# UPSTREAM_PROXY_MODE=direct|proxy_pool
UPSTREAM_PROXY_MODE=direct
# Comma-separated proxy URLs, e.g.:
# UPSTREAM_PROXIES=http://user:pass@1.2.3.4:8080,socks5://user:pass@5.6.7.8:1080
UPSTREAM_PROXIES=
# Strategy: sticky (sticky-by-user, failover when proxy unhealthy)
UPSTREAM_PROXY_STRATEGY=sticky
# Optional salt to make sticky mapping harder to predict
UPSTREAM_PROXY_STICKY_SALT=
UPSTREAM_PROXY_COOLDOWN_SECONDS=10
UPSTREAM_PROXY_MAX_COOLDOWN_SECONDS=120
UPSTREAM_PROXY_FAILURE_THRESHOLD=1
UPSTREAM_PROXY_FAIL_STREAK_CAP=6
UPSTREAM_PROXY_HANDLE_429=true
UPSTREAM_PROXY_HANDLE_5XX=true
UPSTREAM_PROXY_HANDLE_NETWORK_ERRORS=true
UPSTREAM_PROXY_COOLDOWN_429_SECONDS=10
UPSTREAM_PROXY_COOLDOWN_5XX_SECONDS=15
UPSTREAM_PROXY_COOLDOWN_ERROR_SECONDS=10
UPSTREAM_PROXY_KEEPALIVE_ENABLED=false
UPSTREAM_PROXY_KEEPALIVE_INTERVAL_SECONDS=300
UPSTREAM_PROXY_KEEPALIVE_URL=https://api.novelai.net/
UPSTREAM_PROXY_KEEPALIVE_TIMEOUT_SECONDS=8
# Multi-node: avoid every node running keepalive probes (choose ONE leader node)
UPSTREAM_PROXY_KEEPALIVE_LEADER_ONLY=false
UPSTREAM_PROXY_KEEPALIVE_LEADER_NODE_ID=node-1
